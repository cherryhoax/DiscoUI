<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DiscoUI Custom Elements</title>
    <style>
      :root {
        --viewer-bg: #0b1220;
        --panel-bg: rgba(255, 255, 255, 0.04);
        --panel-border: rgba(255, 255, 255, 0.08);
        --text: #e5e7eb;
        --muted: #94a3b8;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: var(--viewer-bg);
        color: var(--text);
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        display: grid;
        place-items: center;
        padding: 32px;
      }

      .app-shell {
        width: min(1200px, 100%);
        display: grid;
        grid-template-columns: 340px 1fr;
        gap: 24px;
        align-items: start;
      }

      .panel {
        background: var(--panel-bg);
        border: 1px solid var(--panel-border);
        border-radius: 16px;
        padding: 18px 20px;
        backdrop-filter: blur(10px);
      }

      .panel h2 {
        margin: 0 0 12px;
        font-size: 16px;
        letter-spacing: 0.02em;
        text-transform: uppercase;
        color: var(--muted);
      }

      .field {
        display: grid;
        gap: 6px;
        margin-bottom: 14px;
      }

      .field label {
        font-size: 13px;
        color: var(--muted);
      }

      .field input,
      .field select {
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid var(--panel-border);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        outline: none;
      }

      .field input[type='color'] {
        padding: 4px;
        height: 42px;
      }

      .viewer {
        display: grid;
        place-items: center;
        position: relative;
      }

      .device {
        width: 480px;
        height: 850px;
        border-radius: 28px;
        border: 1px solid var(--panel-border);
        overflow: hidden;
        background: #000;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.55), 0 0 0 1px rgba(255, 255, 255, 0.05);
        transform-origin: top center;
      }

      .device iframe {
        width: 100%;
        height: 100%;
        border: 0;
        display: block;
        background: transparent;
      }

      .hint {
        margin-top: 8px;
        color: var(--muted);
        font-size: 12px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <div class="panel">
        <h2>Viewer Controls</h2>
        <div class="field">
          <label for="themeSelect">Theme</label>
          <select id="themeSelect">
            <option value="dark">Dark</option>
            <option value="light">Light</option>
          </select>
        </div>
        <div class="field">
          <label for="accentInput">Accent</label>
          <input id="accentInput" type="color" value="#d80073" />
        </div>
        <div class="field">
          <label for="fontSelect">Font</label>
          <select id="fontSelect">
            <option value="'Segoe UI', sans-serif">Segoe UI</option>
            <option value="'Inter', system-ui">Inter</option>
            <option value="'SF Pro Text', -apple-system">SF Pro</option>
          </select>
        </div>
        <div class="field">
          <label for="scaleRange">Scale (0.75–1.25)</label>
          <input id="scaleRange" type="range" min="0.75" max="1.25" step="0.01" value="1" />
        </div>
      </div>

      <div class="viewer">
        <div class="device" id="demoDevice">
          <iframe id="appIframe" src="examples/disco-pivot.html" title="Disco Pivot" loading="eager"></iframe>
        </div>
        <div class="hint">Viewer size locked to 480×850. Scale adjusts frame content, not the shell.</div>
      </div>
    </div>

    <script>
      const iframe = document.getElementById('appIframe');
      const themeSelect = document.getElementById('themeSelect');
      const accentInput = document.getElementById('accentInput');
      const fontSelect = document.getElementById('fontSelect');
      const scaleRange = document.getElementById('scaleRange');

      let iframeDoc = null;
      let innerFrame = null;

      const lastState = {
        theme: themeSelect.value,
        accent: accentInput.value,
        font: fontSelect.value,
        scale: scaleRange.value
      };

      const hydrateIframeRefs = () => {
        iframeDoc = iframe?.contentDocument || iframe?.contentWindow?.document || null;
        innerFrame = iframeDoc?.getElementById('demoFrame') || null;
      };

      const applyTheme = (theme) => {
        lastState.theme = theme;
        if (!iframeDoc) return;
        const target = iframeDoc.documentElement;
        target.style.setProperty('--disco-bg', theme === 'dark' ? '#000' : '#fff');
        target.style.setProperty('--disco-fg', theme === 'dark' ? '#fff' : '#000');
      };

      const applyAccent = (accent) => {
        lastState.accent = accent;
        if (!iframeDoc) return;
        iframeDoc.documentElement.style.setProperty('--disco-accent', accent);
      };

      const applyFont = (font) => {
        lastState.font = font;
        if (!iframeDoc) return;
        iframeDoc.documentElement.style.setProperty('--disco-font', font);
      };

      const applyScale = (scale) => {
        lastState.scale = scale;
        if (!innerFrame) return;
        innerFrame.style.zoom = scale;
      };

      themeSelect.addEventListener('change', (e) => applyTheme(e.target.value));
      accentInput.addEventListener('input', (e) => applyAccent(e.target.value));
      fontSelect.addEventListener('change', (e) => applyFont(e.target.value));
      scaleRange.addEventListener('input', (e) => applyScale(e.target.value));

      iframe.addEventListener('load', () => {
        hydrateIframeRefs();
        applyTheme(lastState.theme);
        applyAccent(lastState.accent);
        applyFont(lastState.font);
        applyScale(lastState.scale);
      });
    </script>
  </body>
</html>
